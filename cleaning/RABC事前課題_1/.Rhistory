library(tidyverse)
library(readxl)
refusal_files <- list.files(path = "/Users/ki/Desktop/RABC事前課題作業/data/raw/assignment1_data/不登校生徒数/", full.names = TRUE)
refusal_files
file_names <- list.files(path = "/Users/ki/Desktop/RABC事前課題作業/data/raw/assignment1_data/不登校生徒数/", full.names = FALSE)
refusal_data <- map(refusal_files, ~read_xlsx(.)) %>% setNames(file_names)
n_of_students <- read_xlsx("/Users/ki/Desktop/RABC事前課題作業/data/raw/assignment1_data/生徒数/生徒数.xlsx")
refusal_files <- list.files(path = "/data/raw/assignment1_data/不登校生徒数/", full.names = TRUE)
library(tidyverse)
library(readxl)
refusal_files <- list.files(path = "/data/raw/assignment1_data/不登校生徒数/", full.names = TRUE)
refusal_files
file_names <- list.files(path = "/data/raw/assignment1_data/不登校生徒数/", full.names = FALSE)
refusal_data <- map(refusal_files, ~read_xlsx(.)) %>% setNames(file_names)
n_of_students <- read_xlsx("/data/raw/assignment1_data/生徒数/生徒数.xlsx")
refusal_files <- list.files(path = "/data/raw/assignment1_data/不登校生徒数/", full.names = TRUE)
file_names <- list.files(path = "/data/raw/assignment1_data/不登校生徒数/", full.names = FALSE)
refusal_data <- map(refusal_files, ~read_xlsx(.)) %>% setNames(file_names)
n_of_students <- read_xlsx("/data/raw/assignment1_data/生徒数/生徒数.xlsx")
n_of_students <- read_xlsx("/Users/ki/Desktop/RABC事前課題_1/data/raw/assignment1_data/生徒数/生徒数.xlsx")
n_of_students <- read_xlsx("/data/raw/assignment1_data/生徒数/生徒数.xlsx")
n_of_students <- read_xlsx("/RABC事前課題_1/data/raw/assignment1_data/生徒数/生徒数.xlsx")
n_of_students <- read_xlsx("/RABC事前課題_1/data/raw/assignment1_data/生徒数/生徒数.xlsx")
n_of_students <- read_xlsx("RABC事前課題_1/data/raw/assignment1_data/生徒数/生徒数.xlsx")
refusal_files <- list.files(path = "/data/raw/assignment1_data/不登校生徒数/", full.names = TRUE)
saveRDS(refusal_data, file = "/data/original/refusal_data.obj")
for(i in 1:10){
colnames(refusal_data[[i]]) <- c("prefecture","refusal numbers","blank")
}
library(tidyverse)
library(readxl)
refusal_files <- list.files(path = "/data/raw/assignment1_data/不登校生徒数/", full.names = TRUE)
refusal_files
file_names <- list.files(path = "/data/raw/assignment1_data/不登校生徒数/", full.names = FALSE)
refusal_data <- map(refusal_files, ~read_xlsx(.)) %>% setNames(file_names)
n_of_students <- read_xlsx("/Users/ki/Desktop/RABC事前課題_1/data/raw/assignment1_data/生徒数/生徒数.xlsx")
for(i in 1:10){
colnames(refusal_data[[i]]) <- c("prefecture","refusal numbers","blank")
}
refusal_data
refusal_data
refusal_files <- list.files(path = "/Users/ki/Desktop/RABC事前課題_1/data/raw/assignment1_data/不登校生徒数/", full.names = TRUE)
refusal_files
file_names <- list.files(path = "/Users/ki/Desktop/RABC事前課題_1/data/raw/assignment1_data/不登校生徒数/", full.names = FALSE)
refusal_data <- map(refusal_files, ~read_xlsx(.)) %>% setNames(file_names)
n_of_students <- read_xlsx("/Users/ki/Desktop/RABC事前課題_1/data/raw/assignment1_data/生徒数/生徒数.xlsx")
for(i in 1:10){
colnames(refusal_data[[i]]) <- c("prefecture","refusal numbers","blank")
}
colnames(n_of_students) <- c("prefecture","year","number of students")
saveRDS(refusal_data, file = "/Users/ki/Desktop/RABC事前課題_1/data/original/refusal_data.obj")
saveRDS(n_of_students, file = "/Users/ki/Desktop/RABC事前課題_1/data/original/n_of_students.obj")
refusal_data <- readRDS("/Users/ki/Desktop/RABC事前課題作業/data/original/refusal_data.obj")
refusal_data <- readRDS("/Users/ki/Desktop/RABC事前課題_1/data/original/refusal_data.obj")
n_of_students <- readRDS("/Users/ki/Desktop/RABC事前課題_1/data/original/n_of_students.obj")
#blankを削除
for(i in 1:10){
refusal_data[[i]] <-
refusal_data[[i]] %>%
select(!blank)
}
#refusal numbersの型変更
for(i in 1:10){
refusal_data[[i]]$`refusal numbers` <-
refusal_data[[i]]$`refusal numbers` %>%
as.numeric()
}
#year列の追加
for(i in 1:10){
refusal_data[[i]] <-
refusal_data[[i]] %>%
mutate(year = 2012 + i)
}
#結合
combined_refusal <-
refusal_data %>% bind_rows()
n_of_students
#join
joined_data <-
left_join(n_of_students, combined_refusal, by = c('prefecture', 'year'))
joined_data <-
joined_data %>%
mutate(refusal_rate = `refusal numbers`/`number of students`)
saveRDS(joined_data, file = "/Users/ki/Desktop/RABC事前課題_1/data/cleaned/refusal_joined.obj")
---
title: "analyze"
library(tidyverse)
library(ggplot2)
joined_data <- readRDS("/Users/ki/Desktop/RABC事前課題_1/data/cleaned/refusal_joined.obj")
refusal_sum <-
joined_data %>% group_by(year) %>% summarise(total_refusals = sum(`refusal numbers`))
#refusal_sum table 図1
refusal_sum %>% View()
#refusal_sum barchart 図1
refusal_sum %>% ggplot(aes(x = year, y = total_refusals)) + geom_col()
#refusal_rate_total line chart 図2
refusal_rate_total <-
joined_data %>% group_by(year) %>% summarise(total_refusal_rate = mean(refusal_rate))
refusal_rate_total %>% ggplot(aes(x = year, y = total_refusal_rate)) +
geom_line() + geom_point() + geom_text(aes(label = round(total_refusal_rate, 2)), vjust = -1) + scale_x_continuous(breaks = refusal_rate_total$year)
#2軸図3
refusal_total <- refusal_rate_total %>% left_join(refusal_sum, by = 'year')
refusal_total_adjusted <- refusal_total %>% mutate(total_refusal_rate = total_refusal_rate*2500000)
refusal_total_adjusted %>% ggplot(aes(x = year), color = "blue") +
geom_col(aes(y = total_refusals)) + geom_line(aes(y = total_refusal_rate), color  = "red") + geom_point(aes(y = total_refusal_rate)) + scale_x_continuous(breaks = refusal_total_adjusted$year) + scale_y_continuous(sec.axis = sec_axis(~./2500000, name="refusal_rate_total"), name="refusal_number")
#図4 histgram
rate_mean <- joined_data %>% filter(year == 2022) %>% pull(refusal_rate) %>%  mean()
joined_data  %>% filter(year == 2022) %>% ggplot(aes(x = refusal_rate)) + geom_histogram() + geom_vline(aes (xintercept = rate_mean), linetype = "dashed", color = "red")
#図5
joined_data_highlight <- joined_data %>%
mutate(highlight = ifelse(prefecture == "長野", 1, 0))
joined_data_highlight  %>% filter(year == 2022) %>% mutate(prefecture = fct_reorder(prefecture, refusal_rate)) %>% ggplot(aes(y = refusal_rate, x = prefecture, fill = highlight)) + geom_col() + theme(axis.text.x = element_text(angle = 45, hjust = 1)) + scale_fill_manual(values = c("1" = "pink", "0" = "grey"))
joined_data_highlight  %>% filter(year == 2022) %>% mutate(prefecture = fct_reorder(prefecture, refusal_rate)) %>% ggplot(aes(y = refusal_rate, x = prefecture, fill = factor(highlight)) + geom_col() + theme(axis.text.x = element_text(angle = 45, hjust = 1)) + scale_fill_manual(values = c("1" = "pink", "0" = "grey"))
joined_data_highlight  %>% filter(year == 2022) %>% mutate(prefecture = fct_reorder(prefecture, refusal_rate)) %>% ggplot(aes(y = refusal_rate, x = prefecture, fill = factor(highlight))) + geom_col() + theme(axis.text.x = element_text(angle = 45, hjust = 1)) + scale_fill_manual(values = c("1" = "pink", "0" = "grey"))
joined_data_highlight  %>% filter(year == 2022) %>% mutate(prefecture = fct_reorder(prefecture, refusal_rate)) %>% ggplot(aes(y = refusal_rate, x = prefecture, fill = factor(highlight))) + geom_col() + theme(axis.text.x = element_text(angle = 45, hjust = 1)) + scale_fill_manual(values = c("1" = "pink", "0" = "grey"))
class_data <- readRDS("/Users/ki/Desktop/RABC事前課題_1/data/original/class_data.obj")
#dfの名前設定
class_data <- class_data %>% setNames(2013:2022)
#学級の取り除きと変数名の再設定、「計」列の削除
class_data_cleaned <- class_data %>% map(~{
new_names <- .x[1, ] %>% unlist() %>% str_remove_all("学級")
.x %>% set_names(new_names) %>% rename_with(~"prefecture", .cols = 1) %>%
slice(-1) %>% select(-計) %>% mutate(across(-prefecture, as.numeric))})
#都道府県番号と結合、並び替え。年列も追加
yearname = 2013:2022
class_data_cleaned2 <- class_data_cleaned %>% map(~ .x %>% mutate(prefecture_id = 1:47))
class_data_cleaned3 <- class_data_cleaned2 %>% seq_along() %>% map (~ class_data_cleaned2[[.x]] %>% mutate(year = yearname[.x]))
class_data_jointed <- class_data_cleaned3 %>% bind_rows() %>% arrange(prefecture_id, year)
#データをlong型に
class_data_names <- 1:24
class_data_names <- class_data_names %>% as.character()
class_data_joined_long <- class_data_joined %>% gather(key = "学級数", value = "該当数", '0', class_data_names, '25～30', '31～36', '37～42', '43～48', '49～54', '55～60', '61以上')
class_data <- readRDS("/Users/ki/Desktop/RABC事前課題_1/data/original/class_data.obj")
#dfの名前設定
class_data <- class_data %>% setNames(2013:2022)
class_data_cleaned <- class_data %>% map(~{
new_names <- .x[1, ] %>% unlist() %>% str_remove_all("学級")
.x %>% set_names(new_names) %>% rename_with(~"prefecture", .cols = 1) %>%
slice(-1) %>% select(-計) %>% mutate(across(-prefecture, as.numeric))})
yearname = 2013:2022
class_data_cleaned2 <- class_data_cleaned %>% map(~ .x %>% mutate(prefecture_id = 1:47))
class_data_cleaned3 <- class_data_cleaned2 %>% seq_along() %>% map (~ class_data_cleaned2[[.x]] %>% mutate(year = yearname[.x]))
class_data_joined <- class_data_cleaned3 %>% bind_rows() %>% arrange(prefecture_id, year)
class_data_names <- 1:24
class_data_names <- class_data_names %>% as.character()
class_data_joined_long <- class_data_joined %>% gather(key = "学級数", value = "該当数", '0', class_data_names, '25～30', '31～36', '37～42', '43～48', '49～54', '55～60', '61以上')
class_data_joined_long <- class_data_joined_long %>% select(-c('61\n以上', '61\r\n以上'))
class_data_joined_long
class_files <- list.files(path = "/Users/ki/Desktop/RABC事前課題作業/data/raw/assignment1_data/学級数/", full.names = TRUE)
file_names <- list.files(path = "/Users/ki/Desktop/RABC事前課題作業/data/raw/assignment1_data/学級数/", full.names = FALSE)
class_data <- map(class_files, ~read_xlsx(.)) %>% setNames(file_names)
for(i in 1:10){
colnames(class_data[[i]]) <- c( "prefecture", "sum", "0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10",
"11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24",
"25-30", "31-36", "37-42", "43-48", "49-54", "55-60", "over_61")
}
class_files <- list.files(path = "/Users/ki/Desktop/RABC事前課題_1/data/raw/assignment1_data/学級数/", full.names = TRUE)
file_names <- list.files(path = "/Users/ki/Desktop/RABC事前課題_1/data/raw/assignment1_data/学級数/", full.names = FALSE)
class_data <- map(class_files, ~read_xlsx(.)) %>% setNames(file_names)
for(i in 1:10){
colnames(class_data[[i]]) <- c( "prefecture", "sum", "0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10",
"11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24",
"25-30", "31-36", "37-42", "43-48", "49-54", "55-60", "over_61")
}
saveRDS(class_data, file = "/Users/ki/Desktop/RABC事前課題_1/data/original/class_data.obj")
